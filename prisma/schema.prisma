generator client {
  provider = "prisma-client-js"
}


datasource db {
  provider = "postgresql"
  url = env("DATABASE_URL")
}

model User {
  id          String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  email       String    @unique
  password    String
  createdAt   DateTime  @default(now())
  name        String
  updatedAt   DateTime  @updatedAt
  expenses    Expense[]
  memberships OrganizationMember[]
}

model Organization {
  id        String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name      String
  createdAt DateTime             @default(now())
  updatedAt DateTime             @updatedAt
  expenses  Expense[]
  members   OrganizationMember[]
}

model OrganizationMember {
  id             String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  role           OrganizationRole

  userId         String           @db.Uuid
  organizationId String           @db.Uuid

  createdAt      DateTime         @default(now())

  organization   Organization     @relation(fields: [organizationId], references: [id])
  user           User             @relation(fields: [userId], references: [id])

  @@unique([userId, organizationId])
  @@index([organizationId])
}


model Expense {
  id             String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  title          String
  description    String?
  amount         Decimal       @db.Decimal(10, 2)
  status         ExpenseStatus @default(PENDING)
  submittedAt    DateTime      @default(now())

  submitterId    String        @db.Uuid
  organizationId String        @db.Uuid

  organization   Organization  @relation(fields: [organizationId], references: [id])
  submitter      User          @relation(fields: [submitterId], references: [id])

  @@index([organizationId])
  @@index([status])
  @@index([submittedAt])
}


enum OrganizationRole {
  ADMIN
  MANAGER
  EMPLOYEE
  FINANCE
}

enum ExpenseStatus {
  PENDING
  MANAGER_APPROVED
  FINANCE_APPROVED
  REJECTED
}
